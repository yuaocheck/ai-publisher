<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Publisher - AI 内容生成</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="config.js"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .ai-card {
            transition: all 0.3s ease;
        }
        .ai-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .typing-animation {
            border-right: 2px solid #667eea;
            animation: typing 2s steps(40, end), blink-caret 0.75s step-end infinite;
        }
        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: #667eea }
        }
        .loading-dots {
            display: inline-block;
        }
        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
        .error-message {
            background-color: #fef2f2;
            border-color: #fecaca;
            color: #dc2626;
        }
        .success-message {
            background-color: #f0fdf4;
            border-color: #bbf7d0;
            color: #16a34a;
        }
        .variation-card {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .variation-card:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .variation-card.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
    </style>
</head>
<body class="bg-gray-50" x-data="aiGenerationData()">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="start.html" class="flex items-center">
                        <div class="h-8 w-8 bg-blue-600 rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold text-sm">AI</span>
                        </div>
                        <span class="ml-2 text-xl font-bold text-gray-900">Publisher</span>
                    </a>
                </div>
                <div class="flex items-center">
                    <a href="start.html" class="text-gray-500 hover:text-gray-700 px-3 py-2 text-sm font-medium">
                        <i class="fas fa-arrow-left mr-2"></i>返回首页
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="gradient-bg py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
                <i class="fas fa-robot text-blue-600 text-2xl"></i>
            </div>
            <h1 class="text-4xl font-bold text-white mb-4">AI 内容生成</h1>
            <p class="text-xl text-blue-100 mb-8 max-w-3xl mx-auto">
                智能生成文案、图片和视频内容，提升创作效率
            </p>
            <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 inline-block">
                <p class="text-white text-sm">
                    <i class="fas fa-magic mr-2"></i>
                    基于 Google Gemini AI，支持多种内容类型和创作风格
                </p>
            </div>
        </div>
    </div>

    <!-- API Key Setup -->
    <div x-show="showApiKeyInput" class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="bg-white rounded-xl shadow-lg p-8 border-l-4 border-blue-500">
            <div class="flex items-center mb-4">
                <i class="fas fa-key text-blue-600 text-xl mr-3"></i>
                <h2 class="text-xl font-bold text-gray-900">设置 Gemini API Key</h2>
            </div>
            <p class="text-gray-600 mb-6">
                为了使用 AI 内容生成功能，您需要提供 Google Gemini API Key。
                <a href="https://makersuite.google.com/app/apikey" target="_blank" class="text-blue-600 hover:text-blue-800 underline">
                    点击这里获取免费 API Key
                </a>
            </p>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">API Key</label>
                    <div class="flex space-x-3">
                        <input
                            type="password"
                            x-model="apiKey"
                            class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="输入您的 Gemini API Key..."
                        >
                        <button
                            @click="saveApiKey()"
                            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition duration-200"
                        >
                            保存
                        </button>
                    </div>
                </div>

                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <div class="flex">
                        <i class="fas fa-exclamation-triangle text-yellow-600 mt-0.5 mr-2"></i>
                        <div class="text-sm text-yellow-800">
                            <strong>隐私说明：</strong>您的 API Key 仅存储在本地浏览器中，不会发送到我们的服务器。
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Error/Success Messages -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div x-show="errorMessage" class="mb-4 p-4 border rounded-lg error-message">
            <div class="flex items-center">
                <i class="fas fa-exclamation-circle mr-2"></i>
                <span x-text="errorMessage"></span>
            </div>
        </div>

        <div x-show="successMessage" class="mb-4 p-4 border rounded-lg success-message">
            <div class="flex items-center">
                <i class="fas fa-check-circle mr-2"></i>
                <span x-text="successMessage"></span>
            </div>
        </div>
    </div>

    <!-- AI Generator -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="bg-white rounded-xl shadow-lg p-8">
            <div class="flex justify-between items-center mb-8">
                <div class="text-center flex-1">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">AI 内容生成器</h2>
                    <p class="text-gray-600">输入您的想法，AI 为您创作精彩内容</p>
                </div>
                <div x-show="!showApiKeyInput">
                    <button
                        @click="showApiKeyInput = true"
                        class="text-gray-500 hover:text-gray-700 text-sm"
                        title="更换 API Key"
                    >
                        <i class="fas fa-cog mr-1"></i>设置
                    </button>
                </div>
            </div>

            <!-- Input Section -->
            <div class="space-y-6">
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-sm font-medium text-gray-700">内容主题</label>
                        <span class="text-xs text-gray-500" x-text="prompt.length + ' 字符'"></span>
                    </div>
                    <textarea
                        x-model="prompt"
                        rows="3"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="例如：介绍我们的新产品功能，包括AI智能推荐、实时数据分析等特性..."
                    ></textarea>

                    <!-- Sample Prompts -->
                    <div class="mt-3">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs text-gray-500">💡 示例提示词</span>
                            <button
                                @click="prompt = getRandomSamplePrompt()"
                                class="text-xs text-blue-600 hover:text-blue-800"
                            >
                                随机示例
                            </button>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <template x-for="(sample, index) in samplePrompts.slice(0, 3)" :key="index">
                                <button
                                    @click="prompt = sample"
                                    class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded-full transition duration-200"
                                    x-text="sample.substring(0, 30) + '...'"
                                ></button>
                            </template>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">内容类型</label>
                        <select x-model="contentType" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="social_post">社交媒体</option>
                            <option value="blog_article">博客文章</option>
                            <option value="marketing_copy">营销文案</option>
                            <option value="product_description">产品描述</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">语调风格</label>
                        <select x-model="tone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="professional">专业</option>
                            <option value="casual">随意</option>
                            <option value="friendly">友好</option>
                            <option value="humorous">幽默</option>
                            <option value="inspiring">鼓舞</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">内容长度</label>
                        <select x-model="length" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="short">简短</option>
                            <option value="medium">中等</option>
                            <option value="long">详细</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">语言</label>
                        <select x-model="language" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="zh-CN">中文</option>
                            <option value="en-US">English</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">目标平台</label>
                    <div class="flex flex-wrap gap-2">
                        <template x-for="platform in platforms" :key="platform.id">
                            <label class="flex items-center">
                                <input 
                                    type="checkbox" 
                                    :value="platform.id"
                                    x-model="selectedPlatforms"
                                    class="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                                >
                                <span class="ml-2 text-sm text-gray-700" x-text="platform.name"></span>
                            </label>
                        </template>
                    </div>
                </div>

                <!-- Platform Character Limits Info -->
                <div x-show="selectedPlatforms.length > 0" class="bg-blue-50 rounded-lg p-4">
                    <h4 class="text-sm font-medium text-blue-900 mb-2">📏 平台字符限制</h4>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                        <template x-for="platformId in selectedPlatforms" :key="platformId">
                            <div class="text-xs text-blue-800">
                                <span x-text="platforms.find(p => p.id === platformId)?.name"></span>:
                                <span x-text="getPlatformLimit(platformId)"></span>字符
                            </div>
                        </template>
                    </div>
                </div>

                <div class="text-center">
                    <button
                        @click="generateContent()"
                        :disabled="generating || !prompt.trim()"
                        class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-8 py-3 rounded-lg font-medium transition duration-200"
                    >
                        <span x-show="!generating">
                            <i class="fas fa-magic mr-2"></i>生成内容
                        </span>
                        <span x-show="generating" class="loading-dots">
                            <i class="fas fa-spinner fa-spin mr-2"></i>AI 正在创作中
                        </span>
                    </button>
                </div>
            </div>

            <!-- Generated Content -->
            <div x-show="generatedContent" class="mt-8 border-t pt-8">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-900">生成的内容</h3>
                    <div class="text-sm text-gray-500">
                        字数: <span x-text="generatedContent.length"></span>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg p-6 mb-4">
                    <div class="whitespace-pre-wrap text-gray-800" x-text="generatedContent"></div>
                </div>

                <div class="flex flex-wrap gap-3 mb-6">
                    <button
                        @click="copyContent()"
                        class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm transition duration-200"
                    >
                        <i class="fas fa-copy mr-2"></i>复制内容
                    </button>
                    <button
                        @click="optimizeContent()"
                        :disabled="generating"
                        class="bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg text-sm transition duration-200"
                    >
                        <i class="fas fa-wand-magic-sparkles mr-2"></i>
                        <span x-show="!generating">优化内容</span>
                        <span x-show="generating">优化中...</span>
                    </button>
                    <button
                        @click="generateVariations()"
                        :disabled="generating"
                        class="bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg text-sm transition duration-200"
                    >
                        <i class="fas fa-shuffle mr-2"></i>
                        <span x-show="!generating">生成变体</span>
                        <span x-show="generating">生成中...</span>
                    </button>
                </div>

                <!-- Content Variations -->
                <div x-show="showVariations && generatedVariations.length > 0" class="mt-6">
                    <h4 class="text-md font-medium text-gray-900 mb-4">内容变体</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <template x-for="(variation, index) in generatedVariations" :key="index">
                            <div
                                @click="selectVariation(index)"
                                :class="selectedVariation === index ? 'selected' : ''"
                                class="variation-card border-2 border-gray-200 rounded-lg p-4"
                            >
                                <div class="flex justify-between items-start mb-2">
                                    <span class="text-sm font-medium text-gray-700">变体 <span x-text="index + 1"></span></span>
                                    <div class="text-xs text-gray-500">
                                        <span x-text="variation.length"></span> 字
                                    </div>
                                </div>
                                <div class="text-sm text-gray-600 line-clamp-4" x-text="variation.substring(0, 100) + (variation.length > 100 ? '...' : '')"></div>
                                <div class="mt-3 text-center">
                                    <button class="text-blue-600 hover:text-blue-800 text-xs font-medium">
                                        选择此变体
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                    <div class="mt-4 text-center">
                        <button
                            @click="showVariations = false"
                            class="text-gray-500 hover:text-gray-700 text-sm"
                        >
                            收起变体
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Usage Tips -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-8">
            <h2 class="text-xl font-bold text-gray-900 mb-6 text-center">💡 使用技巧</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <div class="flex items-start">
                        <div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center mr-3 mt-0.5">
                            <span class="text-blue-600 font-bold text-xs">1</span>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-900">详细描述主题</h4>
                            <p class="text-sm text-gray-600">提供具体的背景信息和目标，AI 能生成更精准的内容</p>
                        </div>
                    </div>

                    <div class="flex items-start">
                        <div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center mr-3 mt-0.5">
                            <span class="text-blue-600 font-bold text-xs">2</span>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-900">选择合适的平台</h4>
                            <p class="text-sm text-gray-600">不同平台有不同的用户习惯，选择目标平台有助于优化内容风格</p>
                        </div>
                    </div>

                    <div class="flex items-start">
                        <div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center mr-3 mt-0.5">
                            <span class="text-blue-600 font-bold text-xs">3</span>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-900">尝试不同语调</h4>
                            <p class="text-sm text-gray-600">根据品牌调性和目标受众选择合适的语调风格</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="flex items-start">
                        <div class="w-6 h-6 bg-purple-100 rounded-full flex items-center justify-center mr-3 mt-0.5">
                            <span class="text-purple-600 font-bold text-xs">4</span>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-900">利用优化功能</h4>
                            <p class="text-sm text-gray-600">生成基础内容后，使用优化功能提升吸引力和互动性</p>
                        </div>
                    </div>

                    <div class="flex items-start">
                        <div class="w-6 h-6 bg-purple-100 rounded-full flex items-center justify-center mr-3 mt-0.5">
                            <span class="text-purple-600 font-bold text-xs">5</span>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-900">生成多个变体</h4>
                            <p class="text-sm text-gray-600">生成多个版本进行对比，选择最符合需求的内容</p>
                        </div>
                    </div>

                    <div class="flex items-start">
                        <div class="w-6 h-6 bg-purple-100 rounded-full flex items-center justify-center mr-3 mt-0.5">
                            <span class="text-purple-600 font-bold text-xs">6</span>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-900">人工审核</h4>
                            <p class="text-sm text-gray-600">AI 生成的内容建议人工审核后再发布，确保准确性</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Features -->
    <div class="bg-white py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-900 mb-4">AI 功能特色</h2>
                <p class="text-xl text-gray-600">强大的 AI 能力，让内容创作更智能</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div class="ai-card text-center p-6 rounded-lg border border-gray-200">
                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-brain text-blue-600 text-xl"></i>
                    </div>
                    <h3 class="font-semibold text-gray-900 mb-2">智能理解</h3>
                    <p class="text-sm text-gray-600">深度理解用户意图，生成符合需求的内容</p>
                </div>
                
                <div class="ai-card text-center p-6 rounded-lg border border-gray-200">
                    <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-palette text-green-600 text-xl"></i>
                    </div>
                    <h3 class="font-semibold text-gray-900 mb-2">多样风格</h3>
                    <p class="text-sm text-gray-600">支持多种语调和风格，适应不同场景</p>
                </div>
                
                <div class="ai-card text-center p-6 rounded-lg border border-gray-200">
                    <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-language text-purple-600 text-xl"></i>
                    </div>
                    <h3 class="font-semibold text-gray-900 mb-2">多语言</h3>
                    <p class="text-sm text-gray-600">支持中文、英文等多种语言内容生成</p>
                </div>
                
                <div class="ai-card text-center p-6 rounded-lg border border-gray-200">
                    <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-rocket text-orange-600 text-xl"></i>
                    </div>
                    <h3 class="font-semibold text-gray-900 mb-2">快速生成</h3>
                    <p class="text-sm text-gray-600">秒级响应，快速生成高质量内容</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Examples -->
    <div class="bg-gray-50 py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-900 mb-4">内容示例</h2>
                <p class="text-xl text-gray-600">看看 AI 能为您创作什么样的内容</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="bg-white rounded-lg p-6 shadow-lg">
                    <div class="flex items-center mb-4">
                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fab fa-twitter text-blue-500"></i>
                        </div>
                        <span class="ml-2 font-medium text-gray-900">Twitter 推文</span>
                    </div>
                    <div class="text-gray-700 text-sm">
                        "🚀 激动地宣布我们的新产品正式发布！经过团队的不懈努力，我们为大家带来了更智能的解决方案。立即体验：link.com #产品发布 #创新 #科技"
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-6 shadow-lg">
                    <div class="flex items-center mb-4">
                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fab fa-linkedin text-blue-700"></i>
                        </div>
                        <span class="ml-2 font-medium text-gray-900">LinkedIn 文章</span>
                    </div>
                    <div class="text-gray-700 text-sm">
                        "在数字化转型的浪潮中，我们见证了技术如何重塑商业模式。今天，我想分享一些关于创新的思考，以及我们如何通过技术创造更大的价值..."
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-6 shadow-lg">
                    <div class="flex items-center mb-4">
                        <div class="w-8 h-8 bg-pink-100 rounded-full flex items-center justify-center">
                            <i class="fab fa-instagram text-pink-500"></i>
                        </div>
                        <span class="ml-2 font-medium text-gray-900">Instagram 文案</span>
                    </div>
                    <div class="text-gray-700 text-sm">
                        "✨ 每一个美好的瞬间都值得被记录 📸 今天想和大家分享一些关于生活的小美好... #生活美学 #分享 #美好时光"
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function aiGenerationData() {
            return {
                // API Configuration
                apiKey: '', // 用户需要输入自己的 Gemini API Key
                showApiKeyInput: true,

                // Form Data
                prompt: '',
                contentType: 'social_post',
                tone: 'professional',
                length: 'medium',
                selectedPlatforms: ['twitter'],
                language: 'zh-CN',

                // Generation State
                generating: false,
                generatedContent: '',
                generatedVariations: [],
                selectedVariation: 0,

                // UI State
                showVariations: false,
                errorMessage: '',
                successMessage: '',
                samplePrompts: [],

                platforms: [
                    { id: 'twitter', name: 'Twitter' },
                    { id: 'facebook', name: 'Facebook' },
                    { id: 'instagram', name: 'Instagram' },
                    { id: 'linkedin', name: 'LinkedIn' },
                    { id: 'tiktok', name: 'TikTok' },
                    { id: 'youtube', name: 'YouTube' }
                ],

                init() {
                    // 检查本地存储的 API Key
                    const savedApiKey = localStorage.getItem('gemini_api_key');
                    if (savedApiKey) {
                        this.apiKey = savedApiKey;
                        this.showApiKeyInput = false;
                    }

                    // 初始化示例提示词
                    this.loadSamplePrompts();
                },

                loadSamplePrompts() {
                    // 使用默认示例提示词
                    this.samplePrompts = [
                        '我们即将发布一款革命性的智能手表，具有健康监测和AI助手功能',
                        '举办线上技术分享会，邀请行业专家分享最新趋势',
                        '分享公司创始人的创业故事和初心',
                        '分析人工智能在教育行业的应用前景',
                        '新推出的在线学习平台，为职场人士提供技能提升课程',
                        '公司年度客户答谢晚宴，感谢合作伙伴的支持'
                    ];
                },

                getRandomSamplePrompt() {
                    if (this.samplePrompts.length === 0) return '';
                    return this.samplePrompts[Math.floor(Math.random() * this.samplePrompts.length)];
                },

                saveApiKey() {
                    if (!this.apiKey.trim()) {
                        this.showError('请输入有效的 API Key');
                        return;
                    }

                    // 简单验证 API Key 格式
                    if (!this.apiKey.startsWith('AIza')) {
                        this.showError('API Key 格式不正确，应该以 "AIza" 开头');
                        return;
                    }

                    localStorage.setItem('gemini_api_key', this.apiKey);
                    this.showApiKeyInput = false;
                    this.showSuccess('API Key 已保存');
                },

                async generateContent() {
                    if (!this.prompt.trim()) {
                        this.showError('请输入内容主题');
                        return;
                    }

                    if (!this.apiKey.trim()) {
                        this.showError('请先设置 Gemini API Key');
                        this.showApiKeyInput = true;
                        return;
                    }

                    this.generating = true;
                    this.errorMessage = '';
                    this.generatedContent = '';
                    this.generatedVariations = [];

                    try {
                        const content = await this.callGeminiAPI();
                        this.generatedContent = content;
                        this.showSuccess('内容生成成功！');
                    } catch (error) {
                        console.error('Generation error:', error);
                        this.showError('生成失败: ' + error.message);
                    } finally {
                        this.generating = false;
                    }
                },

                async callGeminiAPI() {
                    const prompt = this.buildPrompt();

                    const apiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';

                    const generationConfig = {
                        temperature: 0.7,
                        topK: 40,
                        topP: 0.95,
                        maxOutputTokens: 1024,
                    };

                    console.log('发送请求到 Gemini API...', { prompt: prompt.substring(0, 100) + '...' });

                    const response = await fetch(`${apiUrl}?key=${this.apiKey}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }],
                            generationConfig: generationConfig
                        })
                    });

                    console.log('API 响应状态:', response.status, response.statusText);

                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error('API 错误响应:', errorData);
                        const errorMessage = errorData.error?.message || `HTTP ${response.status}: ${response.statusText}`;
                        throw new Error(errorMessage);
                    }

                    const data = await response.json();
                    console.log('API 成功响应:', data);

                    if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                        throw new Error('API 返回了无效的响应格式');
                    }

                    return data.candidates[0].content.parts[0].text;
                },

                buildPrompt() {
                    const contentTypeMap = {
                        social_post: '社交媒体帖子',
                        blog_article: '博客文章',
                        marketing_copy: '营销文案',
                        product_description: '产品描述'
                    };

                    const toneMap = {
                        professional: '专业',
                        casual: '随意',
                        friendly: '友好',
                        humorous: '幽默',
                        inspiring: '鼓舞人心'
                    };

                    const lengthMap = {
                        short: '简短（50-100字）',
                        medium: '中等（100-300字）',
                        long: '详细（300-500字）'
                    };

                    const platformsText = this.selectedPlatforms.map(p =>
                        this.platforms.find(platform => platform.id === p)?.name
                    ).join('、');

                    const prompt = `请为我创作一个${contentTypeMap[this.contentType]}，主题是：${this.prompt}

要求：
- 语调风格：${toneMap[this.tone]}
- 内容长度：${lengthMap[this.length]}
- 目标平台：${platformsText}
- 语言：${this.language === 'zh-CN' ? '中文' : '英文'}

请确保内容：
1. 符合目标平台的特点和用户习惯
2. 具有吸引力和互动性
3. 包含适当的表情符号和标签（如果适用）
4. 语言自然流畅，符合指定的语调风格

请直接返回生成的内容，不需要额外的解释。`;

                    return prompt;
                },

                async generateVariations() {
                    if (!this.generatedContent) {
                        this.showError('请先生成基础内容');
                        return;
                    }

                    this.generating = true;
                    this.errorMessage = '';

                    try {
                        const variations = [];

                        // 生成3个变体
                        for (let i = 0; i < 3; i++) {
                            const variationPrompt = `请基于以下内容创作一个变体版本，保持核心信息不变，但改变表达方式和结构：

原内容：
${this.generatedContent}

要求：
- 保持相同的语调风格：${this.tone}
- 保持相同的内容长度
- 创新表达方式，但不改变核心信息
- 适合平台：${this.selectedPlatforms.join('、')}

请直接返回变体内容：`;

                            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${this.apiKey}`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    contents: [{
                                        parts: [{
                                            text: variationPrompt
                                        }]
                                    }],
                                    generationConfig: {
                                        temperature: 0.8,
                                        topK: 40,
                                        topP: 0.95,
                                        maxOutputTokens: 1024,
                                    }
                                })
                            });

                            if (response.ok) {
                                const data = await response.json();
                                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                                    variations.push(data.candidates[0].content.parts[0].text);
                                }
                            }
                        }

                        this.generatedVariations = variations;
                        this.showVariations = true;
                        this.showSuccess(`成功生成 ${variations.length} 个变体版本！`);

                    } catch (error) {
                        console.error('Variation generation error:', error);
                        this.showError('生成变体失败: ' + error.message);
                    } finally {
                        this.generating = false;
                    }
                },

                async optimizeContent() {
                    if (!this.generatedContent) {
                        this.showError('请先生成内容');
                        return;
                    }

                    this.generating = true;
                    this.errorMessage = '';

                    try {
                        const optimizePrompt = `请优化以下内容，使其更加吸引人和有效：

原内容：
${this.generatedContent}

优化要求：
1. 提高内容的吸引力和互动性
2. 优化结构和表达方式
3. 添加更有效的调用行动（CTA）
4. 保持原有的核心信息和语调
5. 适合平台：${this.selectedPlatforms.join('、')}

请直接返回优化后的内容：`;

                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${this.apiKey}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                contents: [{
                                    parts: [{
                                        text: optimizePrompt
                                    }]
                                }],
                                generationConfig: {
                                    temperature: 0.6,
                                    topK: 40,
                                    topP: 0.95,
                                    maxOutputTokens: 1024,
                                }
                            })
                        });

                        if (!response.ok) {
                            throw new Error(`优化请求失败: ${response.statusText}`);
                        }

                        const data = await response.json();
                        if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                            this.generatedContent = data.candidates[0].content.parts[0].text;
                            this.showSuccess('内容优化完成！');
                        } else {
                            throw new Error('优化响应格式无效');
                        }

                    } catch (error) {
                        console.error('Optimization error:', error);
                        this.showError('优化失败: ' + error.message);
                    } finally {
                        this.generating = false;
                    }
                },

                selectVariation(index) {
                    this.selectedVariation = index;
                    this.generatedContent = this.generatedVariations[index];
                    this.showVariations = false;
                    this.showSuccess('已选择变体版本！');
                },

                copyContent() {
                    if (!this.generatedContent) {
                        this.showError('没有内容可复制');
                        return;
                    }

                    navigator.clipboard.writeText(this.generatedContent).then(() => {
                        this.showSuccess('内容已复制到剪贴板！');
                    }).catch(() => {
                        this.showError('复制失败，请手动复制');
                    });
                },

                showError(message) {
                    this.errorMessage = message;
                    this.successMessage = '';
                    console.error('错误:', message);
                    setTimeout(() => {
                        this.errorMessage = '';
                    }, 5000);
                },

                showSuccess(message) {
                    this.successMessage = message;
                    this.errorMessage = '';
                    console.log('成功:', message);
                    setTimeout(() => {
                        this.successMessage = '';
                    }, 3000);
                },

                clearApiKey() {
                    localStorage.removeItem('gemini_api_key');
                    this.apiKey = '';
                    this.showApiKeyInput = true;
                    this.showSuccess('API Key 已清除');
                },

                getPlatformLimit(platformId) {
                    const defaultLimits = {
                        twitter: 280,
                        facebook: 2000,
                        instagram: 2200,
                        linkedin: 3000,
                        tiktok: 150,
                        youtube: 5000
                    };

                    return defaultLimits[platformId] || 500;
                }
            }
        }
    </script>

    <style>
        [x-cloak] { display: none !important; }
    </style>
</body>
</html>
